(function(){var t,n,e,r=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1},i=[].slice;t="undefined"==typeof window,e=t?require("lodash"):this._,n={},n={createApp:function(t){var n,o,a,s,c,u;return s={stores:[],adapters:[]},c=function(t,n){var e,r,i,o;for(r={},i=0,o=t.length;o>i;i++)e=t[i],r[e]=n(e);return r},u=function(t){var n,i,o,a,s,c,u;if(o=e.filter(t,function(t){return e.isEmpty(t.after)}),e.isEmpty(o))return!1;for(a=e.pluck(o,"storeKey"),s=e.difference(t,o);!e.isEmpty(s);){for(i=!0,c=0,u=s.length;u>c;c++)n=s[c],e.every(n.after,function(t){return r.call(a,t)>=0})&&(i=!1,o.push(n),a.push(n.storeKey));if(i)return!1;s=e.difference(s,o)}return o},n=!1,a=!1,o={actionCallbacks:{},storeCallbacks:{},changedStores:{},onAction:function(t,n,r,i){var o,a;if(null==this.actionCallbacks[n]&&(this.actionCallbacks[n]=[]),e.every(r,function(t){return function(r){return e.find(t.actionCallbacks[n],function(t){return r===t.storeKey})}}(this))||(o=!0),this.actionCallbacks[n].push({storeKey:t,after:r||[],callback:i}),!o){if(a=u(this.actionCallbacks[n]),a===!1)throw this.actionCallbacks[n].pop(),new Error('store "'+t+'"\'s action "'+n+'" creates a circular dependency');return this.actionCallbacks[n]=a}},registerStoreCallback:function(t,n,e){var r;return null==(r=this.storeCallbacks)[t]&&(r[t]=[]),this.storeCallbacks[t].push({adapterKey:n,callback:e})},unregisterStoreCallback:function(t,n){return e.remove(this.storeCallbacks[t],n)},storeHasChanged:function(t){return this.changedStores[t]=!0},sendAction:function(t,r){var i;return i=function(e){return function(){var i,o,a,s,c,u,l,f,h,p;if(n=!0,e.changedStores={},null!=e.actionCallbacks[t])for(f=e.actionCallbacks[t],s=0,u=f.length;u>s;s++)i=f[s],i.callback(r);h=e.changedStores;for(o in h)if(a=h[o],null!=e.storeCallbacks[o])for(p=e.storeCallbacks[o],c=0,l=p.length;l>c;c++)i=p[c],i.callback();return n=!1}}(this),n?i():e.defer(i)},runStoreCallbacks:function(){var t,n,e,r,i;r=this.changedStores,i=[];for(n in r)e=r[n],null!=this.storeCallbacks[n]&&i.push(function(){var e,r,i,o;for(i=this.storeCallbacks[n],o=[],e=0,r=i.length;r>e;e++)t=i[e],o.push(t.callback());return o}.call(this));return i}},{actions:{},stores:{},createActions:function(t){return e.forEach(t,function(t){return function(n,e){return t.createAction(e,n)}}(this))},createAction:function(t,n){return this.actions[t]=function(){return function(){var e,r;return e=1<=arguments.length?i.call(arguments,0):[],r=n.apply(null,e),o.sendAction(t,"object"==typeof r?r:{})}}(this)},createStore:function(t,n){var i,a,u,l,f,h,p,d,b,k;if(a=[],u={},b=function(n,e){var r,i;if("object"==typeof n){i=[];for(t in n)r=n[t],i.push(u[t]=r);return i}return"string"==typeof n?u[n]=e:void 0},i="string"==typeof n.after?[n.after]:Array.isArray(n.after)?n.after:[],r.call(i,t)>=0)throw new Error('store "'+t+'" waits for itself');return l=e.intersection(e.keys(n),["stores","key","get","update"]),e.isEmpty(l)||e.each(l,function(n){throw new Error('In "'+t+'" Store: "'+n+'" is a reserved key and cannot be used.')}),p=e.omit(n,["initialize","api","actions"]),e.each(p,function(t,n){return e.isFunction(t)?p[n]=t.bind(p):void 0}),k=function(){return o.storeHasChanged(t)},e.extend(p,{key:t,api:{},get:function(t){return e.clone(null!=t?u[t]:u)},update:function(t,n){return b(t,n),k()}}),h=this.stores,f={get:function(t){return e.cloneDeep(null!=t?u[t]:u)}},e.forEach(n.api,function(t,n){var e;return"get"!==n?(e=t.bind(p),p.api[n]=e,f[n]=e):void 0}),e.forEach(n.actions,function(n,a){var s,u,l;if("function"==typeof n)l=i,s=n;else{if(t===n.after||r.call(n.after,t)>=0)throw new Error('on action "'+a+'", store "'+t+'" waits for itself to update');l=e.unique(i.concat(n.after)),s=n.action}return u=function(t){return p.stores=c(l,function(t){return h[t]}),s.call(p,t)},o.onAction(t,a,l,u)}),e.isFunction(n.initialize)&&(d=e.omit(p,["actions","update"]),d.update=b,s.stores.push(n.initialize.bind(d))),this.stores[t]=f,f},createAdapter:function(t,n){var r,i,a,c,u,l,f;u={key:t,stores:this.stores,actions:this.actions},l=e.omit(n,["stores","initialize"]);for(i in l)a=l[i],e.isFunction(a)&&(u[i]=a.bind(u));f=n.stores;for(c in f)r=f[c],o.registerStoreCallback(c,t,r.bind(u));return e.isFunction(n.initialize)?s.adapters.push(n.initialize.bind(e.omit(u,"actions"))):void 0},reactMixin:function(t){var n,r,i,a;for(e.isString(t)&&(t=[t]),r={},i=0,a=t.length;a>i;i++)n=t[i],r[n]=this.stores[n];return{stores:r,actions:this.actions,componentDidMount:function(){var r,i,a,s,c;for(c=[],a=0,s=t.length;s>a;a++)n=t[a],r=n.charAt(0).toUpperCase()+n.slice(1),i=this["on"+r+"Change"],c.push(e.isFunction(i)?o.registerStoreCallback(n,"react-view",i):void 0);return c},componentWillUnmount:function(){var r,i,a,s,c;for(c=[],a=0,s=t.length;s>a;a++)n=t[a],r=n.charAt(0).toUpperCase()+n.slice(1),i=this["on"+r+"Change"],c.push(e.isFunction(i)?o.unregisterStoreCallback(n,i):void 0);return c}}},start:function(){var r;return!a&&(e.each(s.stores,function(t){return t()}),delete s.stores,e.each(s.adapters,function(t){return t()}),delete s.adapters,o.runStoreCallbacks(),n=!0,a=!0,null!=t&&e.isFunction(t.initialize))?(r={stores:this.stores,actions:this.actions},t.initialize.call(r)):void 0}}}},t?module.exports=n:window.pipeline=n}).call(this);